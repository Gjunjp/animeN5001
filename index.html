<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第一章：動漫與我的生活</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&family=Noto+Sans+JP:wght@400;500;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* 基礎設定 */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background-color: #2d2d2d;
            font-family: 'Noto Sans JP', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px;
            gap: 40px;
        }

        /* 投影片容器 */
        .slide {
            width: 1000px;
            height: 700px; /* 固定 4:3 比例 */
            background: white;
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            page-break-after: always; /* 方便列印 */
            transition: outline 0.2s;
        }

        /* 編輯與移動模式樣式 */
        .slide[contenteditable="true"] {
            outline: 3px dashed #FF6B6B;
            cursor: text;
        }
        
        /* 移動模式 class */
        .move-mode .slide {
            cursor: grab;
        }
        .move-mode .draggable {
            cursor: grab;
            user-select: none;
            border: 1px dashed #aaa;
            background: rgba(255, 255, 255, 0.5);
        }
        .move-mode .draggable:hover {
            border-color: #FF6B6B;
            background: rgba(255, 255, 255, 0.9);
            z-index: 1001;
        }
        .move-mode .draggable:active {
            cursor: grabbing;
        }

        /* 圖片樣式 */
        .slide img.draggable {
            position: absolute;
            border: none;
            cursor: grab;
        }
        .slide img:hover {
            outline: 2px solid #0984e3;
        }

        /* 頁碼 */
        .page-number {
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-size: 14px;
            color: #aaa;
            font-family: 'Noto Sans TC', sans-serif;
            pointer-events: none;
        }

        /* 動漫主題配色 */
        .theme-pink { --main: #FF6B6B; --sub: #FFE3E3; --text: #2D3436; }
        
        /* 標題樣式 */
        h1 {
            font-family: 'Mochiy Pop One', sans-serif;
            color: var(--main);
            font-size: 48px;
            text-align: center;
            margin-top: auto;
            margin-bottom: auto;
        }

        h2 {
            background: var(--main);
            color: white;
            font-family: 'Mochiy Pop One', sans-serif;
            padding: 15px 30px;
            font-size: 28px;
            margin: 0;
            width: 100%;
        }

        h2 rt {
            color: white !important;
            opacity: 0.9;
        }

        /* 內容區域 */
        .content {
            padding: 40px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* 文字樣式 */
        p, li {
            font-size: 24px;
            color: #2D3436;
            line-height: 1.8;
            margin-bottom: 15px;
            position: relative;
        }

        /* 假名標註 */
        ruby {
            font-family: 'Noto Sans JP', sans-serif;
        }
        rt {
            font-size: 0.5em;
            color: var(--main);
            font-weight: bold;
            transform: translateY(-2px); 
        }

        /* 中文翻譯 */
        .cn {
            display: block;
            color: #636e72;
            font-size: 0.85em; /* 稍微放大 */
            font-family: 'Noto Sans TC', sans-serif;
            margin-top: 2px;
            font-weight: normal;
        }
        
        /* 特別針對問答區放大的中文翻譯 */
        .qa-cn {
            font-size: 1em !important;
            color: #2d3436;
            margin-top: 5px;
            margin-bottom: 15px;
        }

        /* 故事區塊 */
        .story-box {
            background: var(--sub);
            padding: 30px;
            border-radius: 15px;
            border: 2px dashed var(--main);
        }

        /* 對話氣泡 */
        .chat-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .message {
            max-width: 80%;
            padding: 15px;
            border-radius: 20px;
            position: relative;
            font-size: 20px;
        }
        .msg-left {
            align-self: flex-start;
            background: #f1f0f0;
            border-bottom-left-radius: 5px;
        }
        .msg-right {
            align-self: flex-end;
            background: #74b9ff; /* Line Blue */
            color: white;
            border-bottom-right-radius: 5px;
        }
        .msg-right .cn { color: #eaf3ff; }
        .msg-right rt { color: white; opacity: 0.9; }

        /* 單字網格系統 (5x2) */
        .vocab-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 15px;
            height: 100%;
            width: 100%;
        }

        .vocab-card {
            background: white;
            border: 2px solid #eee;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        .vocab-word {
            font-size: 28px;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 5px;
        }
        .vocab-pos {
            background: #eee;
            color: #666;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-bottom: 5px;
        }
        .vocab-cn {
            color: var(--main);
            font-size: 18px;
            font-weight: bold;
        }

        /* 遊戲卡片 */
        .game-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .game-card {
            background: white;
            border: 3px solid var(--main);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* 填空題 */
        .blank {
            display: inline-block;
            width: 100px;
            border-bottom: 2px solid #333;
            text-align: center;
        }
        
        .role-icon {
            font-size: 40px;
            margin-right: 15px;
        }

        /* 工具列樣式 */
        #toolbar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #2d3436;
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
            display: flex;
            gap: 10px;
            z-index: 9999;
            align-items: center;
            font-family: 'Noto Sans TC', sans-serif;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        #toolbar button {
            background: #636e72;
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        #toolbar button:hover {
            background: #b2bec3;
            color: #2d3436;
        }

        #toolbar button.active {
            background: #FF6B6B;
            font-weight: bold;
            color: white;
            box-shadow: 0 0 10px #FF6B6B;
        }

        #toolbar .separator {
            width: 1px;
            height: 20px;
            background: #999;
            margin: 0 5px;
        }

        @media print {
            body { background: white; padding: 0; display: block; }
            .slide { box-shadow: none; margin: 0; page-break-after: always; width: 100%; height: 100%; border: none; outline: none !important; }
            #toolbar { display: none; }
            .draggable { border: none !important; }
        }

    </style>
</head>
<body class="theme-pink">

    <!-- 隱藏的檔案輸入框 -->
    <input type="file" id="img-upload" hidden accept="image/*" onchange="handleImageUpload(this)">

    <!-- 工具列 -->
    <div id="toolbar">
        <span style="font-weight:bold; color:#FF6B6B;">🛠️ 工具：</span>
        
        <button id="btn-edit" onclick="toggleEdit()">✏️ 編輯文字</button>
        <button id="btn-move" onclick="toggleMove()">✋ 移動模式</button>
        
        <div class="separator"></div>

        <button onclick="triggerImageUpload()">📷 插入圖片</button>
        
        <div class="separator"></div>
        
        <button onclick="adjustSize(2)">🔍 放大</button>
        <button onclick="adjustSize(-2)">🔍 縮小</button>
        
        <div class="separator"></div>
        
        <button onclick="window.print()" style="background:#0984e3;">🖨️ 存檔PDF</button>
    </div>

    <!-- Slide 1: Cover -->
    <div class="slide">
        <div style="flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center; background-image: radial-gradient(#FFE3E3 20%, transparent 20%); background-size: 20px 20px;">
            <i class="fa-solid fa-tv" style="font-size: 100px; color: #FF6B6B; margin-bottom: 30px;"></i>
            <h1><ruby>第一章<rt>だいいっしょう</rt></ruby><br>アニメと<ruby>私<rt>わたし</rt></ruby></h1>
            <p style="font-size: 30px; margin-top: 20px;">第一章：動漫與我的生活</p>
        </div>
        <div class="page-number">1 / 33</div>
    </div>

    <!-- Slide 2: Introduction to Characters -->
    <div class="slide">
        <h2><ruby>登場<rt>とうじょう</rt></ruby><ruby>人物<rt>じんぶつ</rt></ruby> (登場人物)</h2>
        <div class="content game-grid">
            <div class="game-card">
                <i class="fa-solid fa-user" style="font-size: 50px; color: #74b9ff; margin-bottom: 10px;"></i>
                <h3 style="margin: 0 0 10px 0; font-size: 28px;"><ruby>翔太<rt>しょうた</rt></ruby></h3>
                <div style="text-align: left; width: 80%;">
                    <p style="margin: 5px 0; font-size: 20px;">● <ruby>高校<rt>こうこう</rt></ruby><ruby>二年生<rt>にねんせい</rt></ruby> <span class="cn">高中二年級</span></p>
                    <p style="margin: 5px 0; font-size: 20px;">● <ruby>好<rt>す</rt></ruby>き：アニメ、ゲーム <span class="cn">喜歡：動漫、遊戲</span></p>
                    <p style="margin: 5px 0; font-size: 20px;">● <ruby>性格<rt>せいかく</rt></ruby>：<ruby>元気<rt>げんき</rt></ruby> <span class="cn">性格：有活力</span></p>
                </div>
            </div>
            <div class="game-card">
                <i class="fa-solid fa-user" style="font-size: 50px; color: #FF6B6B; margin-bottom: 10px;"></i>
                <h3 style="margin: 10px 0;">ゆあ</h3>
                <div style="text-align: left; width: 80%;">
                    <p style="margin: 5px 0; font-size: 20px;">● <ruby>翔太<rt>しょうた</rt></ruby>の<ruby>友達<rt>ともだち</rt></ruby> <span class="cn">翔太的朋友</span></p>
                    <p style="margin: 5px 0; font-size: 20px;">● <ruby>好<rt>す</rt></ruby>き：<ruby>絵<rt>え</rt></ruby>、お<ruby>菓子<rt>かし</rt></ruby> <span class="cn">喜歡：畫畫、零食</span></p>
                    <p style="margin: 5px 0; font-size: 20px;">● <ruby>性格<rt>せいかく</rt></ruby>：<ruby>優<rt>やさ</rt></ruby>しい <span class="cn">性格：溫柔</span></p>
                </div>
            </div>
        </div>
        <div class="page-number">2 / 33</div>
    </div>

    <!-- Slide 3: Story Part 1 -->
    <div class="slide">
        <h2>ストーリー 1：<ruby>自己紹介<rt>じこしょうかい</rt></ruby> (故事：自我介紹)</h2>
        <div class="content">
            <div class="story-box">
                <p>
                    <span class="role-icon">👦🏻</span>はじめまして。<ruby>私<rt>わたし</rt></ruby>は<ruby>翔太<rt>しょうた</rt></ruby>です。
                    <span class="cn">初次見面。我是翔太。</span>
                </p>
                <p>
                    <ruby>高校<rt>こうこう</rt></ruby><ruby>二年生<rt>にねんせい</rt></ruby>です。<ruby>台湾人<rt>たいわんじん</rt></ruby>です。
                    <span class="cn">我是高中二年級生。我是台灣人。</span>
                </p>
                <p>
                    <ruby>趣味<rt>しゅみ</rt></ruby>は アニメと ゲームです。
                    <span class="cn">我的興趣是動漫和遊戲。</span>
                </p>
                <p>
                    <ruby>毎日<rt>まいにち</rt></ruby>、アニメを<ruby>見<rt>み</rt></ruby>ます。
                    <span class="cn">每天都會看動漫。</span>
                </p>
            </div>
        </div>
        <div class="page-number">3 / 33</div>
    </div>

    <!-- Slide 4: Story Part 1 Continued -->
    <div class="slide">
        <h2>ストーリー 1：<ruby>続<rt>つづ</rt></ruby>き (故事：續)</h2>
        <div class="content">
            <div class="story-box">
                <p>
                    <ruby>私<rt>わたし</rt></ruby>は「ハンターハンター」が<ruby>一番<rt>いちばん</rt></ruby><ruby>好<rt>す</rt></ruby>きです。
                    <span class="cn">我最喜歡獵人。</span>
                </p>
                <p>
                    キルアは とてもかっこいいです。
                    <span class="cn">奇犽非常帥氣。</span>
                </p>
                <p>
                    <ruby>週末<rt>しゅうまつ</rt></ruby>、イベントに<ruby>行<rt>い</rt></ruby>きます。
                    <span class="cn">週末我要去參加活動。</span>
                </p>
            </div>
        </div>
        <div class="page-number">4 / 33</div>
    </div>

    <!-- Slide 5: Dialogue 1 (NEW) -->
    <div class="slide">
        <h2><ruby>会話<rt>かいわ</rt></ruby> 1：<ruby>趣味<rt>しゅみ</rt></ruby> (對話：興趣)</h2>
        <div class="content chat-container">
            <div class="message msg-right">
                <ruby>翔太<rt>しょうた</rt></ruby>くん、<ruby>趣味<rt>しゅみ</rt></ruby>は <ruby>何<rt>なん</rt></ruby>ですか。
                <span class="cn">翔太同學，你的興趣是什麼？</span>
            </div>
            <div class="message msg-left">
                <ruby>趣味<rt>しゅみ</rt></ruby>は アニメです。<br>
                ハンターハンターが <ruby>好<rt>す</rt></ruby>きです。
                <span class="cn">我的興趣是動漫。我喜歡獵人。</span>
            </div>
            <div class="message msg-right">
                <ruby>私<rt>わたし</rt></ruby>もです！<br>
                キルアは かっこいいですね。
                <span class="cn">我也是！奇犽很帥氣呢。</span>
            </div>
            <div class="message msg-left">
                はい、とても かっこいいです。
                <span class="cn">對，非常帥氣。</span>
            </div>
        </div>
        <div class="page-number">5 / 33</div>
    </div>

    <!-- Slide 6: Vocabulary List 1 -->
    <div class="slide">
        <h2><ruby>単語<rt>たんご</rt></ruby>リスト (單字表)</h2>
        <div class="content">
            <div class="vocab-grid">
                <!-- Row 1 -->
                <div class="vocab-card">
                    <div class="vocab-pos">名詞</div>
                    <div class="vocab-word"><ruby>趣味<rt>しゅみ</rt></ruby></div>
                    <div class="vocab-cn">興趣</div>
                </div>
                <div class="vocab-card">
                    <div class="vocab-pos">副詞</div>
                    <div class="vocab-word"><ruby>一番<rt>いちばん</rt></ruby></div>
                    <div class="vocab-cn">最 / 第一</div>
                </div>
                <div class="vocab-card">
                    <div class="vocab-pos">動詞</div>
                    <div class="vocab-word"><ruby>見<rt>み</rt></ruby>ます</div>
                    <div class="vocab-cn">看</div>
                </div>
                <div class="vocab-card">
                    <div class="vocab-pos">名詞</div>
                    <div class="vocab-word">イベント</div>
                    <div class="vocab-cn">活動</div>
                </div>
                <div class="vocab-card">
                    <div class="vocab-pos">名詞</div>
                    <div class="vocab-word">アニメ</div>
                    <div class="vocab-cn">動漫</div>
                </div>
                <!-- Row 2 -->
                <div class="vocab-card">
                    <div class="vocab-pos">名詞</div>
                    <div class="vocab-word">ゲーム</div>
                    <div class="vocab-cn">遊戲</div>
                </div>
                <div class="vocab-card">
                    <div class="vocab-pos">名詞</div>
                    <div class="vocab-word"><ruby>漫画<rt>まんが</rt></ruby></div>
                    <div class="vocab-cn">漫畫</div>
                </div>
                <div class="vocab-card">
                    <div class="vocab-pos">名詞</div>
                    <div class="vocab-word">キャラクター</div>
                    <div class="vocab-cn">角色</div>
                </div>
                <div class="vocab-card">
                    <div class="vocab-pos">名詞</div>
                    <div class="vocab-word"><ruby>声優<rt>せいゆう</rt></ruby></div>
                    <div class="vocab-cn">聲優</div>
                </div>
                <div class="vocab-card">
                    <div class="vocab-pos">動詞</div>
                    <div class="vocab-word"><ruby>読<rt>よ</rt></ruby>みます</div>
                    <div class="vocab-cn">閱讀</div>
                </div>
            </div>
        </div>
        <div class="page-number">6 / 33</div>
    </div>

    <!-- Slide 7: Vocabulary Practice (Matching Game) -->
    <div class="slide">
        <h2><ruby>単語<rt>たんご</rt></ruby>ゲーム (單字連連看)</h2>
        <div class="content">
            <p style="text-align: center;">請將左邊的假名與右邊的中文連線：</p>
            <div style="display: flex; justify-content: space-around; margin-top: 30px;">
                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="game-card">しゅみ</div>
                    <div class="game-card">みます</div>
                    <div class="game-card">いちばん</div>
                    <div class="game-card">せいゆう</div>
                    <div class="game-card">まんが</div>
                </div>
                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="game-card">① 看</div>
                    <div class="game-card">② 興趣</div>
                    <div class="game-card">③ 漫畫</div>
                    <div class="game-card">④ 最 / 第一</div>
                    <div class="game-card">⑤ 聲優</div>
                </div>
            </div>
        </div>
        <div class="page-number">7 / 33</div>
    </div>

    <!-- Slide 8: Grammar Point 1 -->
    <div class="slide">
        <h2><ruby>文法<rt>ぶんぽう</rt></ruby> 1：<ruby>好<rt>す</rt></ruby>きです (表達喜歡)</h2>
        <div class="content">
            <div style="background: #fff3cd; padding: 20px; border-radius: 10px; border-left: 10px solid #ffc107;">
                <p style="font-size: 32px; font-weight: bold;">
                    <ruby>名詞<rt>めいし</rt></ruby> <span style="color: #e17055">が</span> <ruby>好<rt>す</rt></ruby>きです。
                </p>
                <p class="cn">我喜歡 [名詞]。</p>
            </div>
            <br>
            <p><i class="fa-solid fa-star"></i> <ruby>私<rt>わたし</rt></ruby>は <strong>アニメ</strong> <span style="color:#e17055">が</span> <ruby>好<rt>す</rt></ruby>きです。</p>
            <p class="cn">我喜歡動漫。</p>
            <br>
            <p><i class="fa-solid fa-star"></i> <ruby>私<rt>わたし</rt></ruby>は <strong>ゲーム</strong> <span style="color:#e17055">が</span> <ruby>好<rt>す</rt></ruby>きです。</p>
            <p class="cn">我喜歡遊戲。</p>
        </div>
        <div class="page-number">8 / 33</div>
    </div>

    <!-- Slide 9: Grammar Practice (Make Sentences) -->
    <div class="slide">
        <h2><ruby>練習<rt>れんしゅう</rt></ruby> (造句練習)</h2>
        <div class="content">
            <p>請用「～が 好きです」練習造句：</p>
            <br>
            <ol style="margin-left: 40px;">
                <li>
                    <ruby>猫<rt>ねこ</rt></ruby> (貓) <i class="fa-solid fa-arrow-right"></i> _______________
                    <p class="cn">範例：猫が好きです。</p>
                </li>
                <br>
                <li>
                    ラーメン (拉麵) <i class="fa-solid fa-arrow-right"></i> _______________
                </li>
                <br>
                <li>
                    <ruby>日本<rt>にほん</rt></ruby> (日本) <i class="fa-solid fa-arrow-right"></i> _______________
                </li>
            </ol>
        </div>
        <div class="page-number">9 / 33</div>
    </div>

    <!-- Slide 10: Class Activity (Survey) -->
    <div class="slide">
        <h2>クラス<ruby>活動<rt>かつどう</rt></ruby> (團體活動)</h2>
        <div class="content">
            <h3 style="text-align: center;">インタビュー (採訪遊戲)</h3>
            <p style="text-align: center; font-size: 20px;">去問3個同學他們喜歡什麼！(クラスメートに聞きましょう)</p>
            <br>
            <div class="story-box" style="background: white;">
                <p><strong><ruby>問<rt>とい</rt></ruby>: </strong>何<ruby>なに</ruby>が <ruby>好<rt>す</rt></ruby>きですか。</p>
                <p class="cn qa-cn">你喜歡什麼？</p>
                <p><strong><ruby>答<rt>こたえ</rt></ruby>: </strong>______ が <ruby>好<rt>す</rt></ruby>きです。</p>
                <p class="cn qa-cn">我喜歡 ______。</p>
            </div>
            <br>
            <p>① (<ruby>名前<rt>なまえ</rt></ruby>: ______) <i class="fa-solid fa-heart" style="color:red"></i> ________</p>
            <p>② (<ruby>名前<rt>なまえ</rt></ruby>: ______) <i class="fa-solid fa-heart" style="color:red"></i> ________</p>
        </div>
        <div class="page-number">10 / 33</div>
    </div>

    <!-- Slide 11: Story Part 2 -->
    <div class="slide">
        <h2>ストーリー 2：お店で (在店裡)</h2>
        <div class="content">
            <div class="story-box">
                <p>
                    <span class="role-icon">👦🏻</span>ここは アニメショップです。
                    <span class="cn">這裡是動漫周邊店。</span>
                </p>
                <p>
                    <ruby>大<rt>おお</rt></ruby>きい <ruby>店<rt>みせ</rt></ruby>ですね。
                    <span class="cn">好大的店喔。</span>
                </p>
                <p>
                    あ！それは <ruby>新<rt>あたら</rt></ruby>しい フィギュアです。
                    <span class="cn">啊！那是新的公仔。</span>
                </p>
                <p>
                    とても かっこいいですね。
                    <span class="cn">非常帥氣呢。</span>
                </p>
            </div>
        </div>
        <div class="page-number">11 / 33</div>
    </div>

    <!-- Slide 12: Story Part 2 Continued -->
    <div class="slide">
        <h2>ストーリー 2：<ruby>続<rt>つづ</rt></ruby>き (故事：續)</h2>
        <div class="content">
            <div class="story-box">
                <p>
                    <span class="role-icon">👧🏻</span>(<ruby>店員<rt>てんいん</rt></ruby>) いらっしゃいませ。
                    <span class="cn">歡迎光臨。</span>
                </p>
                <p>
                    <span class="role-icon">👦🏻</span>すみません。これは いくらですか。
                    <span class="cn">不好意思。這個多少錢？</span>
                </p>
                <p>
                    <span class="role-icon">👧🏻</span>それは <ruby>二千円<rt>にせんえん</rt></ruby>です。
                    <span class="cn">那個是兩千圓。</span>
                </p>
                <p>
                    <span class="role-icon">👦🏻</span>じゃあ、これを ください。
                    <span class="cn">那請給我這個。</span>
                </p>
            </div>
        </div>
        <div class="page-number">12 / 33</div>
    </div>

    <!-- Slide 13: Dialogue 2 (NEW) -->
    <div class="slide">
        <h2><ruby>会話<rt>かいわ</rt></ruby> 2：お店で (對話：在店裡)</h2>
        <div class="content chat-container">
            <div class="message msg-right">
                <ruby>翔太<rt>しょうた</rt></ruby>くん、この キーホルダーを <ruby>見<rt>み</rt></ruby>てください。
                <span class="cn">翔太同學，請看這個鑰匙圈。</span>
            </div>
            <div class="message msg-left">
                <ruby>小<rt>ちい</rt></ruby>さくて、<ruby>可愛<rt>かわい</rt></ruby>いですね。<br>
                いくらですか。
                <span class="cn">很小很可愛呢。多少錢？</span>
            </div>
            <div class="message msg-right">
                <ruby>五百円<rt>ごひゃくえん</rt></ruby>です。<ruby>安<rt>やす</rt></ruby>いです。
                <span class="cn">五百圓。很便宜。</span>
            </div>
            <div class="message msg-left">
                じゃあ、<ruby>買<rt>か</rt></ruby>いたいです。
                <span class="cn">那我想買。</span>
            </div>
        </div>
        <div class="page-number">13 / 33</div>
    </div>

    <!-- Slide 14: Comprehension Questions (Story 1 & 2) -->
    <div class="slide">
        <h2><ruby>読解<rt>どっかい</rt></ruby>チェック (閱讀測驗)</h2>
        <div class="content">
            <p><ruby>問<rt>とい</rt></ruby>１. <ruby>翔太<rt>しょうた</rt></ruby>さんは <ruby>何<rt>なに</rt></ruby>年生ですか。</p>
            <p class="cn">翔太是幾年級生？</p>
            <ul style="list-style: none; margin-left: 20px;">
                <li>ア. <ruby>一年生<rt>いちねんせい</rt></ruby></li>
                <li>イ. <ruby>二年生<rt>にねんせい</rt></ruby></li>
            </ul>
            <br>
            <p><ruby>問<rt>とい</rt></ruby>２. フィギュアは いくらですか。</p>
            <p class="cn">公仔多少錢？</p>
            <ul style="list-style: none; margin-left: 20px;">
                <li>ア. <ruby>二千円<rt>にせんえん</rt></ruby></li>
                <li>イ. <ruby>三千円<rt>さんぜんえん</rt></ruby></li>
            </ul>
        </div>
        <div class="page-number">14 / 33</div>
    </div>

    <!-- Slide 15: Vocabulary List 2 (Adjectives) -->
    <div class="slide">
        <h2><ruby>単語<rt>たんご</rt></ruby>リスト (形容詞)</h2>
        <div class="content">
            <div class="vocab-grid">
                <!-- Row 1 -->
                <div class="vocab-card">
                    <div class="vocab-pos">い<ruby>形<rt>けい</rt></ruby></div>
                    <div class="vocab-word"><ruby>大<rt>おお</rt></ruby>きい</div>
                    <div class="vocab-cn">大的</div>
                </div>
                <div class="vocab-card">
                    <div class="vocab-pos">い<ruby>形<rt>けい</rt></ruby></div>
                    <div class="vocab-word"><ruby>小<rt>ちい</rt></ruby>さい</div>
                    <div class="vocab-cn">小的</div>
                </div>
                <div class="vocab-card">
                    <div class="vocab-pos">い<ruby>形<rt>けい</rt></ruby></div>
                    <div class="vocab-word"><ruby>高<rt>たか</rt></ruby>い</div>
                    <div class="vocab-cn">貴/高</div>
                </div>
                <div class="vocab-card">
                    <div class="vocab-pos">い<ruby>形<rt>けい</rt></ruby></div>
                    <div class="vocab-word">かっこいい</div>
                    <div class="vocab-cn">帥氣的</div>
                </div>
                <div class="vocab-card">
                    <div class="vocab-pos">な<ruby>形<rt>けい</rt></ruby></div>
                    <div class="vocab-word"><ruby>綺麗<rt>きれい</rt></ruby></div>
                    <div class="vocab-cn">漂亮</div>
                </div>
                <!-- Row 2 -->
                <div class="vocab-card">
                    <div class="vocab-pos">い<ruby>形<rt>けい</rt></ruby></div>
                    <div class="vocab-word"><ruby>面白<rt>おもしろ</rt></ruby>い</div>
                    <div class="vocab-cn">有趣的</div>
                </div>
                <div class="vocab-card">
                    <div class="vocab-pos">い<ruby>形<rt>けい</rt></ruby></div>
                    <div class="vocab-word"><ruby>新<rt>あたら</rt></ruby>しい</div>
                    <div class="vocab-cn">新的</div>
                </div>
                <div class="vocab-card">
                    <div class="vocab-pos">い<ruby>形<rt>けい</rt></ruby></div>
                    <div class="vocab-word"><ruby>古<rt>ふる</rt></ruby>い</div>
                    <div class="vocab-cn">舊的</div>
                </div>
                <div class="vocab-card">
                    <div class="vocab-pos">な<ruby>形<rt>けい</rt></ruby></div>
                    <div class="vocab-word"><ruby>有名<rt>ゆうめい</rt></ruby></div>
                    <div class="vocab-cn">有名的</div>
                </div>
                <div class="vocab-card">
                    <div class="vocab-pos">な<ruby>形<rt>けい</rt></ruby></div>
                    <div class="vocab-word"><ruby>好<rt>す</rt></ruby>き</div>
                    <div class="vocab-cn">喜歡的</div>
                </div>
            </div>
        </div>
        <div class="page-number">15 / 33</div>
    </div>

    <!-- Slide 16: Grammar 2 (Adjectives) -->
    <div class="slide">
        <h2><ruby>文法<rt>ぶんぽう</rt></ruby> 2：<ruby>形容詞<rt>けいようし</rt></ruby> (形容詞)</h2>
        <div class="content">
            <div style="background: #e0f7fa; padding: 20px; border-radius: 10px;">
                <p><strong><ruby>肯定<rt>こうてい</rt></ruby> :</strong></p>
                <p><ruby>名詞<rt>めいし</rt></ruby> は <ruby>形容詞<rt>けいようし</rt></ruby> です。</p>
            </div>
            <br>
            <p>1. この <ruby>店<rt>みせ</rt></ruby>は <ruby>大<rt>おお</rt></ruby>きいです。</p>
            <p class="cn">這家店很大。</p>
            <br>
            <p>2. あの キャラクターは <ruby>有名<rt>ゆうめい</rt></ruby>です。</p>
            <p class="cn">那個角色很有名。</p>
        </div>
        <div class="page-number">16 / 33</div>
    </div>

    <!-- Slide 17: Game - Guess Who -->
    <div class="slide">
        <h2>ゲーム：<ruby>誰<rt>だれ</rt></ruby>ですか (猜猜是誰)</h2>
        <div class="content">
            <p>請讀提示，猜猜是哪個動漫角色？</p>
            <div class="story-box" style="margin-top: 20px;">
                <p>ヒント ①：<ruby>髪<rt>かみ</rt></ruby>は <ruby>白<rt>しろ</rt></ruby>です。</p>
                <p class="cn">提示1：頭髮是白色的。</p>
                
                <p>ヒント ②：<ruby>目<rt>め</rt></ruby>は <ruby>青<rt>あお</rt></ruby>です。</p>
                <p class="cn">提示2：眼睛是藍色的。</p>

                <p>ヒント ③：とても かっこいいです。</p>
                <p class="cn">提示3：非常帥氣。</p>
            </div>
            <p style="margin-top: 20px; text-align: center; color: var(--main);"><ruby>答<rt>こた</rt></ruby>え: キルア (ハンターハンター) !!</p>
        </div>
        <div class="page-number">17 / 33</div>
    </div>

    <!-- Slide 18: Grammar - Want to -->
    <div class="slide">
        <h2><ruby>文法<rt>ぶんぽう</rt></ruby> 3：～たいです (想做...)</h2>
        <div class="content">
            <div style="background: #dff9fb; padding: 20px; border-radius: 10px; border-left: 10px solid #74b9ff;">
                <p><strong><ruby>動詞<rt>どうし</rt></ruby> (ます<ruby>形<rt>けい</rt></ruby>) <i class="fa-solid fa-arrow-right"></i> ～たいです</strong></p>
            </div>
            <br>
            <p><i class="fa-solid fa-caret-right"></i> <ruby>行<rt>い</rt></ruby>きます <i class="fa-solid fa-arrow-right"></i> <ruby>行<rt>い</rt></ruby>き<strong>たいです</strong></p>
            <p class="cn">想去</p>
            <br>
            <p><i class="fa-solid fa-caret-right"></i> <ruby>見<rt>み</rt></ruby>ます <i class="fa-solid fa-arrow-right"></i> <ruby>見<rt>み</rt></ruby><strong>たいです</strong></p>
            <p class="cn">想看</p>
            <br>
            <p><i class="fa-solid fa-caret-right"></i> <ruby>買<rt>か</rt></ruby>います <i class="fa-solid fa-arrow-right"></i> <ruby>買<rt>か</rt></ruby>い<strong>たいです</strong></p>
            <p class="cn">想買</p>
        </div>
        <div class="page-number">18 / 33</div>
    </div>

    <!-- Slide 19: LINE Chat Title -->
    <div class="slide">
        <div style="flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center; background: #25D366;">
            <i class="fa-brands fa-line" style="font-size: 150px; color: white;"></i>
            <h1 style="color: white; margin-top: 20px;">ライン <ruby>会話<rt>かいわ</rt></ruby></h1>
            <p style="color: white; font-size: 30px;">翔太とゆあのチャット</p>
        </div>
        <div class="page-number">19 / 33</div>
    </div>

    <!-- Slide 20: LINE Chat Page 1 -->
    <div class="slide">
        <h2>ライン：イベントの<ruby>約束<rt>やくそく</rt></ruby> (約定活動) ①</h2>
        <div class="content chat-container">
            <div class="message msg-right">
                ゆあさん、こんにちは。<br>
                <ruby>明日<rt>あした</rt></ruby>は <ruby>暇<rt>ひま</rt></ruby>ですか。
                <span class="cn">Yua，你好。明天有空嗎？</span>
            </div>
            <div class="message msg-left">
                はい、<ruby>暇<rt>ひま</rt></ruby>ですよ。<br>
                どうしましたか。
                <span class="cn">有喔，有空。怎麼了嗎？</span>
            </div>
            <div class="message msg-right">
                <ruby>明日<rt>あした</rt></ruby>、アニメの イベントが あります。<br>
                <ruby>一緒<rt>いっしょ</rt></ruby>に <ruby>行<rt>い</rt></ruby>きたいです。
                <span class="cn">明天有動漫展。想一起去。</span>
            </div>
            <div class="message msg-left">
                いいですね！<br>
                <ruby>行<rt>い</rt></ruby>きましょう。
                <span class="cn">好耶！一起去吧。</span>
            </div>
        </div>
        <div class="page-number">20 / 33</div>
    </div>

    <!-- Slide 21: LINE Chat Page 2 -->
    <div class="slide">
        <h2>ライン：イベントの<ruby>約束<rt>やくそく</rt></ruby> (約定活動) ②</h2>
        <div class="content chat-container">
            <div class="message msg-right">
                じゃあ、<ruby>駅<rt>えき</rt></ruby>で <ruby>会<rt>あ</rt></ruby>いましょう。<br>
                <ruby>何時<rt>なんじ</rt></ruby>が いいですか。
                <span class="cn">那在車站見。幾點好呢？</span>
            </div>
            <div class="message msg-left">
                <ruby>午前<rt>ごぜん</rt></ruby> <ruby>十時<rt>じゅうじ</rt></ruby>は どうですか。
                <span class="cn">早上十點如何？</span>
            </div>
            <div class="message msg-right">
                はい、<ruby>大丈夫<rt>だいじょうぶ</rt></ruby>です。<br>
                <ruby>楽<rt>たの</rt></ruby>しみです！
                <span class="cn">好，沒問題。好期待！</span>
            </div>
            <div class="message msg-left">
                私もです！<br>
                (スタンプ: オッケー!)
                <span class="cn">我也是！(貼圖: OK)</span>
            </div>
        </div>
        <div class="page-number">21 / 33</div>
    </div>

    <!-- Slide 22: LINE Chat Questions -->
    <div class="slide">
        <h2>ライン の <ruby>質問<rt>しつもん</rt></ruby> (問答)</h2>
        <div class="content">
            <p><ruby>問<rt>とい</rt></ruby>１. <ruby>二人<rt>ふたり</rt></ruby>は <ruby>明日<rt>あした</rt></ruby> <ruby>何<rt>なに</rt></ruby>を しますか。</p>
            <p class="cn">兩人明天要做什麼？</p>
            <div class="blank" style="width: 300px;">____________</div>
            <br><br>
            <p><ruby>問<rt>とい</rt></ruby>２. <ruby>何時<rt>なんじ</rt></ruby>に <ruby>会<rt>あ</rt></ruby>いますか。</p>
            <p class="cn">幾點見面？</p>
            <div class="blank" style="width: 300px;">____________</div>
        </div>
        <div class="page-number">22 / 33</div>
    </div>

    <!-- Slide 23: Story Part 3 (Conclusion) -->
    <div class="slide">
        <h2>ストーリー 3：イベントの<ruby>日<rt>ひ</rt></ruby> (活動當天)</h2>
        <div class="content">
            <div class="story-box">
                <p>
                    <ruby>今日<rt>きょう</rt></ruby>は イベントです。<ruby>人<rt>ひと</rt></ruby>が <ruby>多<rt>おお</rt></ruby>いです。
                    <span class="cn">今天是活動日。人很多。</span>
                </p>
                <p>
                    コスプレイヤー も たくさん います。
                    <span class="cn">也有很多Coser。</span>
                </p>
                <p>
                    <span class="role-icon">👧🏻</span><ruby>写真<rt>しゃしん</rt></ruby>を <ruby>撮<rt>と</rt></ruby>りましょう！
                    <span class="cn">來拍照吧！</span>
                </p>
                <p>
                    <span class="role-icon">👦🏻</span>はい、チーズ！
                    <span class="cn">好，笑一個！</span>
                </p>
            </div>
        </div>
        <div class="page-number">23 / 33</div>
    </div>

    <!-- Slide 24: Dialogue 3 (NEW) -->
    <div class="slide">
        <h2><ruby>会話<rt>かいわ</rt></ruby> 3：イベント (對話：活動)</h2>
        <div class="content chat-container">
            <div class="message msg-right">
                <ruby>人<rt>ひと</rt></ruby>が <ruby>多<rt>おお</rt></ruby>いですね。
                <span class="cn">人很多呢。</span>
            </div>
            <div class="message msg-left">
                はい。<br>
                あ！あの コスプレイヤーは かっこいいです。
                <span class="cn">對啊。啊！那個Coser好帥。</span>
            </div>
            <div class="message msg-right">
                <ruby>本当<rt>ほんとう</rt></ruby>ですね。<br>
                <ruby>一緒<rt>いっしょ</rt></ruby>に <ruby>写真<rt>しゃしん</rt></ruby>を <ruby>撮<rt>と</rt></ruby>りたいです。
                <span class="cn">真的耶。我想一起拍照。</span>
            </div>
            <div class="message msg-left">
                じゃあ、<ruby>行<rt>い</rt></ruby>きましょう！
                <span class="cn">那走吧！</span>
            </div>
        </div>
        <div class="page-number">24 / 33</div>
    </div>

    <!-- Slide 25: Reflection Activity -->
    <div class="slide">
        <h2><ruby>考<rt>かんが</rt></ruby>えましょう (想一想)</h2>
        <div class="content">
            <p style="font-size: 30px;">あなたの「<ruby>推<rt>お</rt></ruby>し」は <ruby>誰<rt>だれ</rt></ruby>ですか？</p>
            <p class="cn">你的「本命」是誰？</p>
            <hr style="margin: 30px 0; border: 1px dashed #ccc;">
            <p>1. どんな <ruby>人<rt>ひと</rt></ruby> / キャラクター ですか。</p>
            <p class="cn">是什麼樣的人/角色？</p>
            <p>2. かっこいいですか。<ruby>可愛<rt>かわい</rt></ruby>いですか。</p>
            <p class="cn">帥氣嗎？可愛嗎？</p>
            <p>3. どこが <ruby>好<rt>す</rt></ruby>きですか。</p>
            <p class="cn">喜歡哪裡？</p>
        </div>
        <div class="page-number">25 / 33</div>
    </div>

    <!-- Slide 26: Writing Prompt -->
    <div class="slide">
        <h2><ruby>作文<rt>さくぶん</rt></ruby>：<ruby>自己紹介<rt>じこしょうかい</rt></ruby> (短文寫作)</h2>
        <div class="content">
            <p>請參考範例，寫一段簡單的自我介紹：</p>
            <div class="story-box" style="background: white; border-color: #74b9ff;">
                <p><ruby>私<rt>わたし</rt></ruby>は (名字) です。</p>
                <p><ruby>高校<rt>こうこう</rt></ruby> (年級) <ruby>年生<rt>ねんせい</rt></ruby>です。</p>
                <p><ruby>趣味<rt>しゅみ</rt></ruby>は (興趣) です。</p>
                <p>(作品名/角色) が <ruby>一番<rt>いちばん</rt></ruby> <ruby>好<rt>す</rt></ruby>きです。</p>
                <p>(形容詞) です。</p>
            </div>
        </div>
        <div class="page-number">26 / 33</div>
    </div>

    <!-- Slide 27: Writing Example -->
    <div class="slide">
        <h2><ruby>例文<rt>れいぶん</rt></ruby> (範例)</h2>
        <div class="content">
            <div class="story-box">
                <p><ruby>私<rt>わたし</rt></ruby>は <strong>アミン</strong> です。</p>
                <p><ruby>高校<rt>こうこう</rt></ruby> <strong>一</strong> <ruby>年生<rt>ねんせい</rt></ruby>です。</p>
                <p><ruby>趣味<rt>しゅみ</rt></ruby>は <strong><ruby>読書<rt>どくしょ</rt></ruby></strong> です。</p>
                <p><strong>「ハリーポッター」</strong> が <ruby>一番<rt>いちばん</rt></ruby> <ruby>好<rt>す</rt></ruby>きです。</p>
                <p>とても <strong><ruby>面白<rt>おもしろ</rt></ruby>い</strong> です。</p>
                <span class="cn">(我是阿明。高一。興趣是閱讀。最喜歡哈利波特。非常有趣。)</span>
            </div>
        </div>
        <div class="page-number">27 / 33</div>
    </div>

    <!-- Slide 28: Review Game 1 -->
    <div class="slide">
        <h2><ruby>復習<rt>ふくしゅう</rt></ruby>ゲーム ① (複習遊戲)</h2>
        <div class="content">
            <h3><ruby>反対<rt>はんたい</rt></ruby><ruby>言葉<rt>ことば</rt></ruby> (相反詞)</h3>
            <p>請說出相反的形容詞：</p>
            <br>
            <div class="game-grid">
                <div class="game-card">
                    <p><ruby>問<rt>とい</rt></ruby>: <ruby>大<rt>おお</rt></ruby>きい (大)</p>
                    <p style="color:red; margin-top:20px;"><ruby>答<rt>こたえ</rt></ruby>: _________</p>
                </div>
                <div class="game-card">
                    <p><ruby>問<rt>とい</rt></ruby>: <ruby>高<rt>たか</rt></ruby>い (貴)</p>
                    <p style="color:red; margin-top:20px;"><ruby>答<rt>こたえ</rt></ruby>: _________</p>
                </div>
            </div>
            <p style="margin-top:30px; text-align:center; font-size:18px; color:#aaa;">(<ruby>答<rt>こた</rt></ruby>え: 小さい / 安い)</p>
        </div>
        <div class="page-number">28 / 33</div>
    </div>

    <!-- Slide 29: Review Game 2 -->
    <div class="slide">
        <h2><ruby>復習<rt>ふくしゅう</rt></ruby>ゲーム ② (句子重組)</h2>
        <div class="content">
            <p>請重組句子：</p>
            <br>
            <p>1. [ 好き / が / アニメ / 私 / は / です ]</p>
            <p style="border-bottom: 2px solid #ccc; height: 40px; margin-bottom: 30px;"></p>
            
            <p>2. [ 行き / です / たい / 日本 / へ ]</p>
            <p style="border-bottom: 2px solid #ccc; height: 40px; margin-bottom: 30px;"></p>

            <p class="cn">1. 我喜歡動漫。 2. 想去日本。</p>
        </div>
        <div class="page-number">29 / 33</div>
    </div>

    <!-- Slide 30: Culture Note -->
    <div class="slide">
        <h2><ruby>文化<rt>ぶんか</rt></ruby>コラム (文化專欄)</h2>
        <div class="content">
            <h3>「推<ruby>お</ruby>し活<ruby>かつ</ruby>」</h3>
            <p>
                日本的年輕人很流行「<ruby>推<rt>お</rt></ruby>し<ruby>活<rt>かつ</rt></ruby>」。
                <span class="cn">日本的年輕人很流行「推活」(支持偶像/角色的活動)。</span>
            </p>
            <ul style="margin-left: 40px;">
                <li>グッズを <ruby>買<rt>か</rt></ruby>います (買周邊)</li>
                <li>イベントに <ruby>行<rt>い</rt></ruby>きます (去活動)</li>
                <li><ruby>誕生日<rt>たんじょうび</rt></ruby>を <ruby>祝<rt>いわ</rt></ruby>います (慶祝角色生日)</li>
            </ul>
        </div>
        <div class="page-number">30 / 33</div>
    </div>

    <!-- Slide 31: Homework -->
    <div class="slide">
        <h2><ruby>宿題<rt>しゅくだい</rt></ruby> (回家作業)</h2>
        <div class="content">
            <div class="story-box" style="background: white;">
                <p>1. 寫下你最喜歡的三個動漫/遊戲角色。</p>
                <p>2. 用日文形容詞 (かっこいい、可愛い) 介紹他們。</p>
                <p>3. 下週上課分享！</p>
            </div>
            <br>
            <div style="text-align: center;">
                <i class="fa-solid fa-pen-fancy" style="font-size: 50px; color: var(--main);"></i>
            </div>
        </div>
        <div class="page-number">31 / 33</div>
    </div>

    <!-- Slide 32: Next Week Preview -->
    <div class="slide">
        <h2><ruby>来週<rt>らいしゅう</rt></ruby>の<ruby>予告<rt>よこく</rt></ruby> (下週預告)</h2>
        <div class="content">
            <div style="text-align: center;">
                <i class="fa-solid fa-school" style="font-size: 80px; color: #0891b2; margin-bottom: 20px;"></i>
                <h3 style="color: #0891b2; font-size: 40px;">第二章：学校生活</h3>
                <p class="cn">第二章：學校生活</p>
                <br>
                <p>日本的高中制服？校規？社團？</p>
                <p>下週見！(また来週！)</p>
            </div>
        </div>
        <div class="page-number">32 / 33</div>
    </div>

    <!-- Slide 33: End -->
    <div class="slide">
        <div style="flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center;">
            <h1>おしまい</h1>
            <p style="font-size: 30px; margin-top: 20px;">(結束)</p>
            <br>
            <p>お<ruby>疲<rt>つか</rt></ruby>れ<ruby>様<rt>さま</rt></ruby>でした！</p>
            <p class="cn">大家辛苦了！</p>
            <i class="fa-regular fa-face-smile-wink" style="font-size: 80px; color: #FF6B6B; margin-top: 50px;"></i>
        </div>
        <div class="page-number">33 / 33</div>
    </div>

    <script>
        let isEditMode = false;
        let isMoveMode = false;
        let selectedElement = null;

        // 切換編輯模式
        function toggleEdit() {
            if (isMoveMode) toggleMove(); // 關閉移動模式

            isEditMode = !isEditMode;
            const slides = document.querySelectorAll('.slide');
            const btn = document.getElementById('btn-edit');
            
            slides.forEach(slide => {
                slide.setAttribute('contenteditable', isEditMode);
            });

            if (isEditMode) {
                btn.innerHTML = "💾 完成編輯";
                btn.classList.add('active');
            } else {
                btn.innerHTML = "✏️ 編輯文字";
                btn.classList.remove('active');
            }
        }

        // 切換移動模式
        function toggleMove() {
            if (isEditMode) toggleEdit(); // 關閉編輯模式
            
            isMoveMode = !isMoveMode;
            const btn = document.getElementById('btn-move');
            const body = document.body;
            
            // 找出所有可以拖曳的元素 (p, li, h2, h3, .story-box, .game-card, .blank, img)
            const draggables = document.querySelectorAll('p, li, h2, h3, .story-box, .game-card, .blank, img');

            if (isMoveMode) {
                body.classList.add('move-mode');
                btn.innerHTML = "💾 鎖定位置";
                btn.classList.add('active');
                
                draggables.forEach(el => {
                    el.classList.add('draggable');
                    if(el.tagName === 'IMG') el.setAttribute('draggable', false); // 防止預設圖片拖曳
                    
                    // 為了讓它們可以被移動，如果它們還沒有 absolute，我們需要處理
                    el.onmousedown = dragMouseDown;
                });
                alert("✋ 移動模式已開啟！\n您可以拖曳畫面上的文字或圖片。\n如果文字換行了，可以把它拖到正確位置。");
            } else {
                body.classList.remove('move-mode');
                btn.innerHTML = "✋ 移動模式";
                btn.classList.remove('active');
                
                draggables.forEach(el => {
                    el.classList.remove('draggable');
                    el.onmousedown = null;
                });
            }
        }

        // 圖片上傳相關
        function triggerImageUpload() {
            document.getElementById('img-upload').click();
        }

        function handleImageUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.width = "200px"; // 預設大小
                    img.style.position = "absolute";
                    img.style.top = "100px";
                    img.style.left = "100px";
                    img.style.zIndex = "100";
                    img.classList.add('draggable');
                    
                    // 點擊選取圖片以便縮放
                    img.onclick = function() {
                        selectedElement = img;
                        // 移除其他圖片的選取框
                        document.querySelectorAll('img').forEach(i => i.style.outline = "none");
                        img.style.outline = "3px solid #0984e3";
                    };

                    // 找出目前可視的 Slide (簡單判定：最接近視窗中心的)
                    // 這裡簡單加到第一個 Slide 或視窗中間
                    // 為了方便，我們加到目前捲動到的 Slide
                    const slides = document.querySelectorAll('.slide');
                    let targetSlide = slides[0];
                    // 簡單邏輯：加到第一頁，使用者自己拖
                    // 進階：判斷 scrollY
                    
                    targetSlide.appendChild(img);
                    
                    if(isMoveMode) {
                         img.onmousedown = dragMouseDown;
                    }
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // 調整大小 (針對選取的圖片 或 文字)
        function adjustSize(delta) {
            // 如果有選取圖片
            if (selectedElement && selectedElement.tagName === 'IMG') {
                const w = parseFloat(window.getComputedStyle(selectedElement).width);
                selectedElement.style.width = (w + (delta * 10)) + "px"; // 圖片變化大一點
                return;
            }

            // 如果是編輯文字
            const selection = window.getSelection();
            if (selection.rangeCount > 0 && !selection.isCollapsed) {
                const node = selection.anchorNode.parentElement;
                if (node) {
                    const currentSize = parseFloat(window.getComputedStyle(node).fontSize);
                    node.style.fontSize = (currentSize + delta) + "px";
                }
            } else if (isEditMode) {
                // 如果在編輯模式但沒選取，嘗試調整點擊處
                alert("請先選取一段文字，或點擊圖片！");
            } else {
                 alert("請先選取圖片，或進入編輯模式選取文字！");
            }
        }
        
        // 拖曳邏輯 (修正版)
        function dragMouseDown(e) {
            if (!isMoveMode) return;
            e.preventDefault();
            
            let elmnt = e.target;
            // 往上找直到找到 draggable 的元素 (避免點擊到 ruby/rt)
            while (!elmnt.classList.contains('draggable') && elmnt.parentElement) {
                elmnt = elmnt.parentElement;
                if(elmnt.tagName === 'BODY') return;
            }

            // 如果是選取圖片，紀錄選取
            if(elmnt.tagName === 'IMG') {
                selectedElement = elmnt;
                document.querySelectorAll('img').forEach(i => i.style.outline = "none");
                elmnt.style.outline = "3px solid #0984e3";
            }

            // 如果元素還是 static，改成 absolute 才能移動
            const style = window.getComputedStyle(elmnt);
            if (style.position === 'static') {
                const rect = elmnt.getBoundingClientRect();
                
                // 找出這個元素所在的 .slide 容器
                const slide = elmnt.closest('.slide');
                if (slide) {
                    const slideRect = slide.getBoundingClientRect();

                    elmnt.style.position = 'absolute';
                    elmnt.style.width = rect.width + 'px'; // 固定寬度避免跑版
                    // 計算相對於 .slide 的位置
                    elmnt.style.left = (rect.left - slideRect.left) + 'px';
                    elmnt.style.top = (rect.top - slideRect.top) + 'px';
                    elmnt.style.margin = '0';
                    elmnt.style.zIndex = '1000';
                }
            }

            let pos3 = e.clientX;
            let pos4 = e.clientY;

            document.onmouseup = closeDragElement;
            document.onmousemove = elementDrag;

            function elementDrag(e) {
                e.preventDefault();
                let pos1 = pos3 - e.clientX;
                let pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                
                elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
                elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }
        
        // 支援滑鼠滾輪縮放圖片
        document.addEventListener('wheel', function(e) {
            if (selectedElement && selectedElement.tagName === 'IMG' && isMoveMode) {
                e.preventDefault();
                const delta = e.deltaY > 0 ? -10 : 10;
                const w = parseFloat(window.getComputedStyle(selectedElement).width);
                selectedElement.style.width = Math.max(50, w + delta) + "px";
            }
        }, { passive: false });

    </script>
</body>
</html>